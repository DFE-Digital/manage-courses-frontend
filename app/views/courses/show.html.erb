<%= content_for :page_title, "#{@course.name} (#{@course.course_code}) - Courses" %>

<% content_for :before_content do %>
  <nav class="govuk-breadcrumbs">
    <ol class="govuk-breadcrumbs__list">
      <% if @has_multiple_providers then %>
        <li class="govuk-breadcrumbs__list-item">
          <%= link_to "Organisations", providers_path, class: "govuk-breadcrumbs__link" %>
        </li>
      <% end %>
      <li class="govuk-breadcrumbs__list-item">
        <%= link_to @provider[:provider_name], provider_path(code: @provider[:provider_code]), class: "govuk-breadcrumbs__link" %>
      </li>
      <li class="govuk-breadcrumbs__list-item">
        <%= link_to "Courses", provider_courses_path(@provider[:provider_code]), class: "govuk-breadcrumbs__link" %>
      </li>
    </ol>
  </nav>
<% end %>

<h1 class="govuk-heading-xl">
  <span class="govuk-caption-xl"><%= @course.description %></span>
  <%= @course.name %> (<%= @course.course_code %>)
</h1>

<div class="course-tabs govuk-tabs">
  <h2 class="govuk-tabs__title">Contents</h2>

  <ul class="govuk-tabs__list" role="tablist">
    <li class="govuk-tabs__list-item" role="presentation">
      <%=
        link_to manage_ui_course_page_url( provider_code: @provider[:provider_code], course_code: @course.attributes[:course_code]),
        class: "govuk-tabs__tab", role: 'tab', tabindex: '0', aria: { selected: false } do
      %>
        Description<br>
        <span class="govuk-body-s govuk-!-font-weight-regular pointer-events-none">Content, fees and eligibility</span>
      <% end %>
    </li>

    <li class="govuk-tabs__list-item" role="presentation">
      <%=
        link_to "#information",
        class: "govuk-tabs__tab govuk-tabs__tab--selected", id: "tab_information", role: 'tab', tabindex: '-1', aria: { selected: true } do
      %>
        Basic details<br>
        <span class="govuk-body-s govuk-!-font-weight-regular pointer-events-none">Locations, outcome, subject</span>
      <% end %>
    </li>
  </ul>

  <section class="govuk-tabs__panel" id="information" role="tabpanel" aria-labelledby="tab_information">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Level
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__level">
              <%= @course.attributes[:level]&.humanize %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              <abbr class="text-decoration-underline-dotted" title="Special educational needs and disability">SEND</abbr>
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__is_send">
              <%= course_send(@course) %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              <%= 'Subject'.pluralize(@course.subjects.count) %>
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__subjects">
              <%= @course.subjects.join(', ') %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Outcome
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__qualifications">
              <%= course_outcome(@course) %>
            </dd>
          </div>

          <% if @provider.accredited_body? then %>
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                Apprenticeship
              </dt>
              <dd class="govuk-summary-list__value" data-qa="course__apprenticeship">
                <%= course_apprenticeship(@course) %>
              </dd>
            </div>
          <% else %>
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                Fee or salary
              </dt>
              <dd class="govuk-summary-list__value" data-qa="course__funding">
                <%= course_funding(@course) %>
              </dd>
            </div>
          <% end %>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Full or part time
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__study_mode">
              <%= course_study_mode(@course) %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Locations
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__locations">
              <% if @course.site_statuses.size == 1 then %>
                <%= @course.site_statuses.first.site.location_name %>
              <% else %>
                <ul class="govuk-list courses-locations-list">
                  <% @course.site_statuses.map(&:site).map(&:location_name).each do |location_name| %>
                    <li><%= location_name %></li>
                  <% end %>
                </ul>
              <% end %>
              <% if @provider.sites.size == 1 then %>
                <p class="govuk-body govuk-hint">You can’t change this because you only have 1&nbsp;location</p>
                <p class="govuk-body">
                  <%= link_to "Manage all your locations", provider_sites_path(@provider[:provider_code]), class: "govuk-link" %>
                </p>
              <% end %>
            </dd>
          </div>

          <% unless @provider.accredited_body? then %>
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                Accredited body
              </dt>
              <dd class="govuk-summary-list__value" data-qa="course__accredited_body">
                <%= @course.accrediting_provider&.provider_name %>
              </dd>
            </div>
          <% end %>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Applications open
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__applications_open">
              <%= course_applications_open(@course) %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Course starts
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__start_date">
              <%= course_start_date(@course) %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Title
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__name">
              <%= @course.name %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Description
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__description">
              <%= @course.description %>
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Course code
            </dt>
            <dd class="govuk-summary-list__value" data-qa="course__course_code">
              <%= @course.course_code %>
            </dd>
          </div>
        </dl>
      </div>
      <% if @course.is_running? %>
        <div class="govuk-grid-column-one-third">
          <div class="status-box">
            <h2 class="govuk-heading-m">Changing the details of this course</h2>
            <p>You can only change some details of this course – this is because it’s been published, and candidates may have started applying for it.</p>
            <p>If you need to make significant changes to this course, you should consider <%= link_to "withdrawing it", withdraw_provider_course_path(@provider[:provider_code], @course.attributes[:course_code]), class: "govuk-link" %> and creating a new course instead.</p>
            <p>To make any other changes, <%= bat_contact_mail_to "Contact the Becoming a Teacher team", subject: "Edit #{@course.name} (#{@provider_code}/#{@course.course_code})" %>.</p>
          </div>
        </div>
      <% end %>
    </div>
  </section>
</div>
